import { Callout, Tab, Tabs } from 'nextra/components'

# æ‰“åŒ… (swcpack)

<Callout emoji="ğŸš§">
  è¿™ä¸ªåŠŸèƒ½å°†åœ¨ v2 ç‰ˆæœ¬ä¸­ç§»é™¤ï¼Œæ¨èä½¿ç”¨åŸºäº SWC çš„æ‰“åŒ…å·¥å…·ï¼Œå¦‚ [Parcel 2](https://parceljs.org/)ã€[Turbopack](https://turbo.build/pack/docs)ã€[rspack](https://rspack.dev/)ã€[fe-farm](https://www.farmfe.org/)ã€‚

è¯·æ”¹ç”¨ä¸Šè¿°æ‰“åŒ…å·¥å…·ã€‚

</Callout>

SWC èƒ½å¤Ÿå°†å¤šä¸ª JavaScript æˆ– TypeScript æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ã€‚

è¿™ä¸ªåŠŸèƒ½ç›®å‰åä¸º `spack`ï¼Œä½†åœ¨ `v2` ä¸­å°†é‡å‘½åä¸º `swcpack`ã€‚`spack.config.js` å°†è¢«å¼ƒç”¨ï¼Œæ”¹ä¸º `swcpack.config.js`ã€‚

æŸ¥çœ‹[æ‰“åŒ…çš„åŸºæœ¬ç¤ºä¾‹](https://github.com/swc-project/pkgs/tree/main/packages/cli/examples/spack-basic)ã€‚

## ä½¿ç”¨æ–¹æ³•

<Tabs items={['pnpm', 'npm', 'yarn']}>
  <Tabs.Tab>
    ```bash copy
    pnpm i -D @swc/cli @swc/core
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash copy
    npm i -D @swc/cli @swc/core
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```bash copy
    yarn add -D @swc/cli @swc/core
    ```
  </Tabs.Tab>
</Tabs>

åˆ›å»ºä¸€ä¸ª `spack.config.js` æ–‡ä»¶å¹¶è¿è¡Œï¼š

```bash
npx spack
```

## é…ç½®

æŸ¥çœ‹æ‰€æœ‰é€‰é¡¹ï¼Œè¯·å‚é˜…[é…ç½®æ–‡æ¡£](/docs/configuration/bundling)ã€‚

## ç‰¹æ€§

### ç´§å‡‘è¾“å‡º

å°±åƒ `rollup` ä¸€æ ·ï¼ŒSWC è¾“å‡ºç´§å‡‘çš„ä»£ç ã€‚

```js filename="a.js"
console.log("loading A");
export function a() {
  console.log("use!");
}
```

```js filename="lib.js"
import { a } from "./a";
a();
```

ç”Ÿæˆï¼š

```js filename="output.js"
console.log("loading A");
function a() {
  console.log("use!");
}
a();
```

SWC åœ¨è®¾è®¡æ—¶å°±è€ƒè™‘äº†åˆå¹¶é—®é¢˜ï¼Œå› æ­¤ä¼šè‡ªåŠ¨å¤„ç†å¤šä¸ªæ–‡ä»¶ä¹‹é—´çš„å‘½åå†²çªã€‚

### æ‘‡æ ‘ä¼˜åŒ– (Tree Shaking)

å°±åƒå…¶ä»–ç°ä»£æ‰“åŒ…å·¥å…·ä¸€æ ·ï¼ŒSWC å¯ä»¥ç§»é™¤æœªä½¿ç”¨çš„å¯¼å‡ºã€‚

### å¯¼å…¥è§£æ„ (Import Deglobbing)

ä¸ºäº†è¾…åŠ©æ‘‡æ ‘ä¼˜åŒ–ï¼ŒSWC ä¼šå°½å¯èƒ½åœ°è§£æ„å¯¼å…¥ã€‚

```js
import * as lib from "lib";
lib.foo();
```

å…¶è¡Œä¸ºä¸ä»¥ä¸‹ä»£ç å®Œå…¨ç›¸åŒï¼š

```js
import { foo } from "lib";
foo();
```

è¿™æ ·å¯ä»¥ä¿ç•™æ‰€æœ‰å‰¯ä½œç”¨ã€‚

### CommonJS æ”¯æŒ

SWC æ”¯æŒå¯¼å…¥ CommonJS æ¨¡å—ï¼Œå¹¶ä¸”æ¯” webpack è¾“å‡ºæ›´ç´§å‡‘çš„ä»£ç ã€‚

```js filename="source.js"
import * as lib from "lib";
console.log(lib); // é˜²æ­¢ dce
```

å¦‚æœä¸Šé¢çš„ `lib` æ˜¯ä¸€ä¸ª CommonJS æ¨¡å—ï¼Œå®ƒä¼šè¢«è½¬è¯‘ä¸ºï¼š

```js filename="output.js"
const load = __spack_require.bind(void 0, function (module, exports) {
  // è¿™é‡Œæ˜¯ lib çš„ä»£ç 
});
const lib = load();
console.log(lib); // é˜²æ­¢ dce
```

### ä¼˜åŒ–

- å…¨å±€å†…è”ï¼ˆä¾‹å¦‚ `process.env.NODE_ENV`ï¼‰
- å†…è”
- å¸¸é‡ä¼ æ’­
- æ­»ä»£ç æ¶ˆé™¤

ä¸Šé¢æè¿°çš„æ‘‡æ ‘ä¼˜åŒ–ä½¿ç”¨çš„æ˜¯æ­»ä»£ç æ¶ˆé™¤é€šé“ã€‚ç›®å‰ï¼ŒSWC å¯ä»¥å°†ï¼š

```js filename="source.js"
let b = 2;
let a = 1;
if (b) {
  a = 2;
}
let c;
if (a) {
  c = 3;
}
console.log(c);
```

ç®€åŒ–ä¸ºï¼š

```js filename="output.js"
console.log(3);
```

### é«˜æ€§èƒ½

æ€§èƒ½æ˜¯ SWC çš„ä¼˜å…ˆäº‹é¡¹ã€‚å®ƒéå¸¸å¿«ï¼Œå› ä¸ºå®ƒä½¿ç”¨æ‰€æœ‰ CPU æ ¸å¿ƒå¹¶ç”± `llvm` ä¼˜åŒ–ã€‚

### å¤šå…¥å£æ”¯æŒ

```js filename="spack.config.js"
const { config } = require("@swc/core/spack");

module.exports = config({
  entry: {
    web: __dirname + "/src/web.ts",
    android: __dirname + "/src/android.ts",
  },
  output: {
    path: __dirname + "/lib",
  },
  module: {},
});
```

### å†…ç½®ä»£ç åˆ†å‰²

ä½¿ç”¨ä¸Šé¢çš„é…ç½®ï¼Œå¦‚æœ `android.ts` å’Œ `web.ts` éƒ½å¼•ç”¨äº†ç›¸åŒçš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°†è¢«æå–ä¸ºå•ç‹¬çš„å—ï¼Œå¹¶ä¸” `web.ts` å’Œ `android.ts` å°†å¯¼å…¥å®ƒã€‚
